<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Свалка</title>
  <style>
    body {
      margin: 0;
      background: black;
      color: white;
      font-family: sans-serif;
      overflow: hidden;
    }
    #text {
      padding: 20px;
      font-size: 20px;
      line-height: 1.5;
      position: relative;
      z-index: 1;
    }
    canvas {
      position: absolute;
      top: 0;
      left: 0;
      z-index: 2;
      pointer-events: none;
    }
    .word {
      display: inline-block;
      white-space: pre;
    }
  </style>
</head>
<body>
  <div id="text">
    Это пример длинного текста, который сначала выглядит нормально, но через несколько секунд рушится вниз и образует хаос внизу страницы.
  </div>
  <canvas id="world"></canvas>

  <script src="https://cdn.jsdelivr.net/npm/matter-js@0.19.0/build/matter.min.js"></script>
  <script>
    const { Engine, Render, Runner, Bodies, World, Body, Events } = Matter;

    const engine = Engine.create();
    const world = engine.world;

    const canvas = document.getElementById("world");
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    const render = Render.create({
      canvas: canvas,
      engine: engine,
      options: {
        width: window.innerWidth,
        height: window.innerHeight,
        background: "transparent",
        wireframes: false
      }
    });

    Render.run(render);
    const runner = Runner.create();
    Runner.run(runner, engine);

    const ground = Bodies.rectangle(window.innerWidth / 2, window.innerHeight + 30, window.innerWidth, 60, { isStatic: true });
    World.add(world, ground);

    // Разбиваем текст на span'ы
    const textDiv = document.getElementById("text");
    const words = textDiv.innerText.split(/(\s+)/);
    textDiv.innerHTML = "";
    words.forEach(w => {
      const span = document.createElement("span");
      span.textContent = w;
      if (w.trim() !== "") span.classList.add("word");
      textDiv.appendChild(span);
    });

    // Запускаем падение через 4 секунды
    setTimeout(() => {
      document.querySelectorAll(".word").forEach(span => {
        const rect = span.getBoundingClientRect();
        const body = Bodies.rectangle(
          rect.left + rect.width / 2,
          rect.top + rect.height / 2,
          rect.width,
          rect.height,
          {
            restitution: 0.6,
            friction: 0.05,
            render: { fillStyle: "black" }
          }
        );
        body.label = span.textContent;

        Body.applyForce(body, body.position, {
          x: (Math.random() - 0.5) * 0.02,
          y: Math.random() * 0.02
        });

        World.add(world, body);

        // Скрываем исходный span (чтобы видно было только текст от канваса)
        span.style.visibility = "hidden";
      });

      Events.on(render, "afterRender", () => {
        const ctx = render.context;
        ctx.fillStyle = "white";
        ctx.font = "20px sans-serif";
        ctx.textBaseline = "middle";
        world.bodies.forEach(body => {
          if (body.label && body.label.trim() !== "" && body.label !== "Ground") {
            ctx.save();
            ctx.translate(body.position.x, body.position.y);
            ctx.rotate(body.angle);
            ctx.fillText(body.label, -body.label.length * 6, 0);
            ctx.restore();
          }
        });
      });
    }, 4000);
  </script>
</body>
</html>
