<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Свалка текста</title>
<style>
  body, html {
    margin: 0;
    padding: 0;
    overflow: hidden;
    font-family: monospace;
    background: black;
    color: white;
  }
  #textContainer {
    position: absolute;
    top: 10px;
    left: 10px;
    right: 10px;
    font-size: 20px;
    line-height: 1.5;
  }
</style>
</head>
<body>

<div id="textContainer">
  Вот твой огромный ворох текста который будет сначала виден подряд, как обычный абзац, а потом хаотично упадёт вниз.
</div>

<canvas id="canvas"></canvas>

<script>
const container = document.getElementById('textContainer');
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');

function resizeCanvas() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
window.addEventListener('resize', resizeCanvas);
resizeCanvas();

ctx.font = '20px monospace'; // сначала задаём шрифт для правильного measureText

const words = container.innerText.split(/\s+/);
const wordObjects = [];

let x = 10;
let y = 30;
const lineHeight = 25;
const spaceWidth = ctx.measureText(' ').width;

words.forEach(word => {
  const wordWidth = ctx.measureText(word).width;
  if (x + wordWidth > canvas.width - 10) { // перенос строки
    x = 10;
    y += lineHeight;
  }
  wordObjects.push({
    text: word,
    x: x,
    y: y,
    baseX: x, // базовая позиция для начального абзаца
    baseY: y,
    speed: 50 + Math.random() * 100
  });
  x += wordWidth + spaceWidth;
});

let startTime = null;
const fallDelay = 4000;
const maxFallY = canvas.height - 20;

function animate(timestamp) {
  if (!startTime) startTime = timestamp;
  const elapsed = timestamp - startTime;

  ctx.clearRect(0, 0, canvas.width, canvas.height);
  ctx.fillStyle = 'white';
  ctx.font = '20px monospace';

  wordObjects.forEach(word => {
    if (elapsed > fallDelay) {
      word.y += word.speed * 0.016; // падение вниз
      if (word.y > maxFallY) word.y = maxFallY;
      // добавляем лёгкую хаотичность по горизонтали
      word.x = word.baseX + (Math.random() - 0.5) * 20;
    } else {
      // до падения используем исходные позиции
      word.x = word.baseX;
      word.y = word.baseY;
    }
    ctx.fillText(word.text, word.x, word.y);
  });

  requestAnimationFrame(animate);
}

// Скрываем исходный блок после 4 секунд
setTimeout(() => { container.style.display = 'none'; }, fallDelay);

requestAnimationFrame(animate);
</script>
</body>
</html>
