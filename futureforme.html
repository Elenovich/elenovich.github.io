<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Бредовей некуда</title>
<link href="https://fonts.googleapis.com/css2?family=Lora&display=swap" rel="stylesheet">
<style>
body {
  background-color: #080D17;
  color: #fff;
  font-family: 'Lora', serif;
  margin: 0;
  display: flex;
  flex-direction: column;
  min-height: 100vh;
}

header {
  padding: 2rem 0 1rem;
  text-align: center;
}

header h1 a {
  color: #fff;
  text-decoration: none;
}

header h1 a:hover,
header h1 a:focus,
header h1 a:active,
header h1 a:visited {
  color: #fff;
  text-decoration: none;
}

main {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  text-align: center;
  padding: 2rem 1rem;
}

h2 {
  margin-bottom: 30px;
}

#prediction {
  margin-top: 20px;
  font-size: 22px;
  color: #fff;
  text-align: center;
  min-height: 70px;
  max-width: 90%;
  padding: 20px 25px;
  border-radius: 12px;
  background: linear-gradient(135deg, rgba(255,255,255,0.05), rgba(255,255,255,0.1), rgba(255,255,255,0.05));
  box-shadow: 0 4px 15px rgba(0,0,0,0.3);
  backdrop-filter: blur(3px);
  word-wrap: break-word;
}

#source-box {
  margin-top: 15px;
  font-size: 16px;
  color: #ccc;
  max-width: 90%;
  text-align: center;
  padding: 10px 15px;
  border-radius: 10px;
  background: linear-gradient(135deg, rgba(255,255,255,0.02), rgba(255,255,255,0.05), rgba(255,255,255,0.02));
}

button {
  margin-top: 20px;
  padding: 12px 24px;
  background: none;
  border: 1px solid rgba(255,255,255,0.5);
  color: #fff;
  cursor: pointer;
  border-radius: 6px;
  font-size: 16px;
  transition: background 0.3s ease;
}
button:hover {
  background: rgba(255,255,255,0.1);
}

#back-link {
  margin-top: 20px;
}
#back-link a {
  color: #fff;
  text-decoration: none;
}

footer {
  text-align: center;
  color: #888;
  margin-top: auto;
  padding: 1rem 0;
  border-top: 1px solid #444;
  font-size: 0.9rem;
}
footer a {
  color: #888;
  text-decoration: none;
}
</style>
</head>
<body>

<header>
  <h1><a href="index.html">elenovich.lol</a></h1>
</header>

<main>
  <h2>Нагадай мне, большая черепаха</h2>

  <button id="generateBtn">Сгенерировать предсказание</button>

  <div id="prediction"></div>

  <div id="source-box"></div>

  <div id="back-link">
    <a href="index.html">Вернуться назад</a>
  </div>
</main>

<footer>
  <a href="index.html">© 2025 elenovich.lol</a>
</footer>

<script>
// Загружаем JSON с поэмами
fetch('poems.json')
  .then(res => res.json())
  .then(data => {

    function generatePrediction() {
      if (!data.length) {
        document.getElementById('prediction').textContent = "Нет слов в словаре.";
        return;
      }

      // Выбираем случайный стих
      const randomPoemIndex = Math.floor(Math.random() * data.length);
      const poem = data[randomPoemIndex];

      // Разбиваем на слова
      const words = poem.content.replace(/\s+/g,' ').trim().split(' ').filter(w=>w.length>0);

      // Выбираем случайное слово и 5 соседей
      const wordCount = 4 + Math.floor(Math.random()*3); // 4–6 слов
      let randomIndex = Math.floor(Math.random() * words.length);
      let start = randomIndex - Math.floor(wordCount/2);
      if(start<0) start=0;
      let end = start+wordCount;
      if(end>words.length){ end = words.length; start = Math.max(0,end-wordCount);}
      const finalWords = words.slice(start,end);

      const predictionEl = document.getElementById('prediction');
      predictionEl.textContent = '';

      // Анимация подбора слов
      const animationDuration = 3000; // 3 секунды
      const intervalTime = 80; // ms
      const frames = Math.floor(animationDuration/intervalTime);
      let frame = 0;
      const animatedWords = finalWords.map(w => '');

      const anim = setInterval(()=>{
        frame++;
        for(let i=0;i<finalWords.length;i++){
          // Берем случайное слово из стихов для анимации
          const randomPoem = data[Math.floor(Math.random()*data.length)];
          const randomWordArr = randomPoem.content.replace(/\s+/g,' ').trim().split(' ').filter(w=>w.length>0);
          animatedWords[i] = randomWordArr[Math.floor(Math.random()*randomWordArr.length)];
        }
        predictionEl.textContent = animatedWords.join(' ');
        if(frame>=frames){
          clearInterval(anim);
          predictionEl.textContent = finalWords.join(' ');
          // Источник
          const sourceBox = document.getElementById('source-box');
          sourceBox.innerHTML = 'Взято отсюда: <a href="'+poem.url+'">'+poem.title+'</a>';
        }
      }, intervalTime);
    }

    document.getElementById('generateBtn').onclick = generatePrediction;
  })
  .catch(err => {
    console.error("Ошибка загрузки JSON:", err);
    document.getElementById('prediction').textContent = "Ошибка загрузки словаря.";
  });
</script>

</body>
</html>
