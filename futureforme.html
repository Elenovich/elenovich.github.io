<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Бредовей некуда</title>
<link rel="stylesheet" href="style_poem.css">
<style>
/* Минималистичное окошко предсказания */
#prediction {
  margin-top: 20px;
  font-size: 22px;
  color: #fff;
  text-align: center;
  min-height: 70px;
  max-width: 90%;
  padding: 20px 25px;
  border-radius: 12px;
  background: linear-gradient(135deg, rgba(255,255,255,0.05), rgba(255,255,255,0.1), rgba(255,255,255,0.05));
  box-shadow: 0 4px 15px rgba(0,0,0,0.3);
  backdrop-filter: blur(3px);
  word-wrap: break-word;
}

/* Кнопка генерации */
button {
  margin-top: 20px;
  padding: 12px 24px;
  background: none;
  border: 1px solid rgba(255,255,255,0.5);
  color: #fff;
  cursor: pointer;
  border-radius: 6px;
  font-size: 16px;
  transition: background 0.3s ease;
}
button:hover { background: rgba(255,255,255,0.1); }

/* Источник стиха */
#source-box {
  margin-top: 15px;
  font-size: 16px;
  text-align: center;
  color: #ccc;
}

/* "Вернуться назад" */
#back-link {
  margin-top: 15px;
  text-align: center;
}
#back-link a {
  color: #fff;
  text-decoration: none;
}
#back-link a:hover { color: #fff; text-decoration: none; }
</style>
</head>
<body>

<!-- Header -->
<header>
  <h1><a href="index.html">elenovich.lol</a></h1>
</header>

<main class="poem-container" style="align-items: center;">

<h2>Нагадай мне, больная черепаха</h2>

<button id="generateBtn">Сгенерировать предсказание</button>

<div id="prediction"></div>

<div id="source-box"></div>

<div id="back-link">
  <a href="index.html">Вернуться назад</a>
</div>

</main>

<!-- Footer -->
<footer>
  <div class="footer-copy">
    <a href="index.html" class="footer-link">© 2025 elenovich.lol</a>
  </div>
</footer>

<script>
// Загружаем JSON с поэмами
fetch('poems.json')
  .then(res => res.json())
  .then(data => {

    function generatePrediction() {
      if (!data.length) {
        document.getElementById('prediction').textContent = "Нет слов в словаре.";
        return;
      }

      // Выбираем случайный стих
      const randomPoem = data[Math.floor(Math.random() * data.length)];
      const words = randomPoem.content
        .replace(/\s+/g,' ')
        .trim()
        .split(' ')
        .filter(w=>w.length>0);

      const wordCount = 4 + Math.floor(Math.random()*3); // 4-6 слов

      // Выбираем случайное слово и соседние
      const randomIndex = Math.floor(Math.random()*words.length);
      let start = Math.max(0, randomIndex - Math.floor(wordCount/2));
      let end = Math.min(words.length, start + wordCount);
      start = Math.max(0, end - wordCount); // если близко к концу

      const finalWords = words.slice(start, end);

      // Анимация подбора слов
      const predictionDiv = document.getElementById('prediction');
      predictionDiv.textContent = '';
      const duration = 3000; // 3 секунды
      const intervalTime = 80;
      const steps = duration / intervalTime;
      let currentStep = 0;

      const tempWords = finalWords.map(() => '');
      const anim = setInterval(() => {
        currentStep++;
        for (let i=0;i<finalWords.length;i++){
          if(Math.random()>0.2) tempWords[i] = words[Math.floor(Math.random()*words.length)];
        }
        predictionDiv.textContent = tempWords.join(' ');
        if(currentStep>=steps){
          clearInterval(anim);
          // показываем финальный результат
          predictionDiv.textContent = finalWords.join(' ');
          // Добавляем точку в конце, если нужно
          predictionDiv.textContent = predictionDiv.textContent.charAt(0).toUpperCase() + predictionDiv.textContent.slice(1) + '.';
          // Источник
          const sourceBox = document.getElementById('source-box');
          sourceBox.innerHTML = 'Взято отсюда: <a href="'+randomPoem.url+'">'+randomPoem.title+'</a>';
        }
      }, intervalTime);
    }

    document.getElementById('generateBtn').onclick = generatePrediction;

  })
  .catch(err => {
    console.error("Ошибка загрузки JSON:", err);
    document.getElementById('prediction').textContent = "Ошибка загрузки словаря.";
  });
</script>

</body>
</html>
